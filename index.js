(function(){"use strict";function d(o,e,t,v,i,a,n,r){var s=typeof o=="function"?o.options:o;return e&&(s.render=e,s.staticRenderFns=t,s._compiled=!0),{exports:o,options:s}}const l={props:{},computed:{pageId(){return this.endpoints.model.replace(/^\/pages\//,"").replace(/\+/g,"/")},blockId(){return this.id},fieldName(){var o;return(o=this.endpoints.field.match(/\/fields\/([^/]+)/))==null?void 0:o[1]},posterUrl(){var o;return((o=this.content.poster[0])==null?void 0:o.url)||null}},methods:{async handleGenerateVideoPoster(){const o=document.querySelector('.k-page-view-header [aria-label="Save"]');o&&(o.click(),await new Promise(i=>setTimeout(i,500)));let e=this.$el.querySelector("video");e||(e=document.createElement("video"),e.src=this.content.url,e.crossOrigin="anonymous",e.muted=!0,e.playsInline=!0,await new Promise(i=>{e.addEventListener("loadedmetadata",i,{once:!0})}),e.currentTime=0,await new Promise(i=>{e.addEventListener("seeked",i,{once:!0})}));const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toBlob(async i=>{try{const a=this.id+"_poster.jpeg",n=new FormData;n.append("pageId",this.pageId),n.append("blockId",this.blockId),n.append("fieldName",this.fieldName),n.append("videoUrl",this.content.url),n.append("posterFilename",a),n.append("posterFile",i,a);const r=await fetch("/external-video/upload",{method:"POST",body:n});if(!r.ok)throw new Error("(External Video) Upload failed - Response Status: "+r.status);const s=await r.json();s.success&&(this.posterUrl=s.file.url,this.$reload())}catch(a){console.error("(External Video) Upload failed - Error:",a)}finally{t.width=0,t.height=0}},"image/jpeg",.8)}},mounted(){const o=this.$el.querySelector("video");o&&o.setAttribute("crossorigin","anonymous")}};var c=function(){var e=this,t=e._self._c;return t("div",{staticClass:"es-external-video-block"},[t("div",{staticClass:"es-external-video-container",class:{"is-hidden":!e.content.url}},[t("k-video-file-preview",{staticClass:"k-file-preview",attrs:{details:e.details,url:e.content.url,"video-attrs":{crossOrigin:"anonymous"}}}),t("div",{staticClass:"es-external-video-poster-wrapper"},[t("k-button",e._b({staticClass:"es-generate-video-poster-button",attrs:{icon:"image",variant:"filled"},on:{click:e.handleGenerateVideoPoster}},"k-button",e.$props,!1),[e._v("Generate Video Poster")]),t("k-block-figure",[t("k-image-frame",{attrs:{cover:!1,back:"black",ratio:1/1,src:e.posterUrl}})],1)],1)],1),t("div",{staticClass:"es-warning",class:{"is-hidden":e.content.url}},[t("p",[e._v("External Video URL missing.")])])])},p=[],u=d(l,c,p);const m=u.exports;panel.plugin("eriksiemund/external-video",{blocks:{external_video:m}})})();
