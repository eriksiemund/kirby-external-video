(function(){"use strict";function d(t,e,i,v,n,a,o,r){var s=typeof t=="function"?t.options:t;return e&&(s.render=e,s.staticRenderFns=i,s._compiled=!0),{exports:t,options:s}}const l={props:{},computed:{pageId(){return this.endpoints.model.replace(/^\/pages\//,"")},blockId(){return this.id},fieldName(){var t;return(t=this.endpoints.field.match(/\/fields\/([^/]+)/))==null?void 0:t[1]},posterUrl(){var t;return((t=this.content.poster[0])==null?void 0:t.url)||null}},methods:{async handleGenerateVideoPoster(){const t=document.querySelector('.k-page-view-header [aria-label="Save"]');t&&(t.click(),await new Promise(n=>setTimeout(n,500)));let e=this.$el.querySelector("video");e||(e=document.createElement("video"),e.src=this.content.url,e.crossOrigin="anonymous",e.muted=!0,e.playsInline=!0,await new Promise(n=>{e.addEventListener("loadedmetadata",n,{once:!0})}),e.currentTime=0,await new Promise(n=>{e.addEventListener("seeked",n,{once:!0})}));const i=document.createElement("canvas");i.width=e.videoWidth,i.height=e.videoHeight,i.getContext("2d").drawImage(e,0,0,i.width,i.height),i.toBlob(async n=>{try{const a=this.id+"_poster.jpeg",o=new FormData;o.append("pageId",this.pageId),o.append("blockId",this.blockId),o.append("fieldName",this.fieldName),o.append("videoUrl",this.content.url),o.append("posterFilename",a),o.append("posterFile",n,a);const r=await fetch("/external-video/upload",{method:"POST",body:o});if(!r.ok)throw new Error("(External Video) Upload failed - Response Status: "+r.status);const s=await r.json();s.success&&(this.posterUrl=s.file.url,this.$reload())}catch(a){console.error("(External Video) Upload failed - Error:",a)}finally{i.width=0,i.height=0}},"image/jpeg",.8)}},mounted(){const t=this.$el.querySelector("video");t&&t.setAttribute("crossorigin","anonymous")}};var c=function(){var e=this,i=e._self._c;return i("div",{staticClass:"es-external-video-block"},[i("div",{staticClass:"es-external-video-container",class:{"is-hidden":!e.content.url}},[i("k-video-file-preview",{staticClass:"k-file-preview",attrs:{details:e.details,url:e.content.url,"video-attrs":{crossOrigin:"anonymous"}}}),i("div",{staticClass:"es-external-video-poster-wrapper"},[i("k-button",e._b({staticClass:"es-generate-video-poster-button",attrs:{icon:"image",variant:"filled"},on:{click:e.handleGenerateVideoPoster}},"k-button",e.$props,!1),[e._v("Generate Video Poster")]),i("k-block-figure",[i("k-image-frame",{attrs:{cover:!1,back:"black",ratio:1/1,src:e.posterUrl}})],1)],1)],1),i("div",{staticClass:"es-external-video-container",class:{"is-hidden":e.content.url}},[e._m(0)])])},p=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"es-warning"},[e("p",[t._v("External Video URL missing.")])])}],u=d(l,c,p);const m=u.exports;panel.plugin("eriksiemund/external-video",{blocks:{external_video:m}})})();
