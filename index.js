(function(){"use strict";function l(e,t,n,o,i,d,a,s){var r=typeof e=="function"?e.options:e;return t&&(r.render=t,r.staticRenderFns=n,r._compiled=!0),{exports:e,options:r}}const u={props:{},computed:{pageId(){return this.endpoints.model.replace(/^\/pages\//,"")},blockId(){return this.id},fieldName(){var e;return(e=this.endpoints.field.match(/\/fields\/([^/]+)/))==null?void 0:e[1]}},methods:{handleUrlInput(e){this.update({url:e})},async handleGenerateVideoPoster(){let e=this.$el.querySelector("video");e||(e=document.createElement("video"),e.src=this.content.url,e.crossOrigin="anonymous",e.muted=!0,e.playsInline=!0,await new Promise(o=>{e.addEventListener("loadedmetadata",o,{once:!0})}),e.currentTime=0,await new Promise(o=>{e.addEventListener("seeked",o,{once:!0})}));const t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toBlob(async o=>{try{const i=c=>{const v=Math.floor(c),g=Math.round(c%1*100).toString().padStart(2,"0");return`${v}_${g}`},d=this.id+"_"+i(e.currentTime)+Date.now()+".png",a=new FormData;a.append("pageId",this.pageId),a.append("blockId",this.blockId),a.append("fieldName",this.fieldName),a.append("posterFilename",d),a.append("posterFile",o,d);const s=await fetch("/external-video/upload",{method:"POST",body:a});if(!s.ok)throw new Error("(External Video) Upload failed - Response Status: "+s.status);(await s.json()).success&&this.$reload()}catch(i){console.error("(External Video) Upload failed - Error:",i)}finally{t.width=0,t.height=0}},"image/png")}},mounted(){const e=this.$el.querySelector("video");e&&e.setAttribute("crossorigin","anonymous")}};var p=function(){var o;var t=this,n=t._self._c;return n("div",{staticClass:"es-external-video-block"},[n("k-video-file-preview",{staticClass:"k-file-preview",attrs:{details:t.details,url:t.content.url}}),n("div",{staticClass:"es-external-video-poster-wrapper"},[n("k-button",t._b({staticClass:"es-generate-video-poster-button",attrs:{icon:"image",variant:"filled"},on:{click:t.handleGenerateVideoPoster}},"k-button",t.$props,!1),[t._v("Generate Video Poster")]),n("k-block-figure",[n("k-image-frame",{attrs:{cover:!1,back:"black",ratio:1/1,src:(o=t.content.poster[0])==null?void 0:o.url}})],1)],1)],1)},h=[],m=l(u,p,h);const f=m.exports;panel.plugin("eriksiemund/external-video",{blocks:{external_video:f}})})();
